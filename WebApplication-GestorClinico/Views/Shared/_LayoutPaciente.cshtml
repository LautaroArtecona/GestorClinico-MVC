@using Microsoft.AspNetCore.Identity
@using WebApplication_GestorClinico.Context
@using WebApplication_GestorClinico.Models

@inject UserManager<IdentityUser> UserManager
@inject ClinicaDBContext Context

@{
    // LÓGICA GLOBAL PARA EL NOMBRE
    string nombreMostrar = User.Identity?.Name;

    // Si esta logueado buscamos el nombre en la bd
    if (User.Identity != null && User.Identity.IsAuthenticated)
    {
        var userId = UserManager.GetUserId(User);
        // Buscamos el paciente vinculado a este usuario
        var paciente = Context.Pacientes.FirstOrDefault(p => p.UsuarioId == userId);

        if (paciente != null)
        {
            nombreMostrar = $"{paciente.Nombre} {paciente.Apellido}";
        }
    }
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - Portal Paciente</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/portal-paciente.css" />
</head>
<body>
    <div class="top-bar">
        <div class="d-flex align-items-center gap-2">
            <i class="bi bi-hospital-fill fs-3" style="color: var(--color-principal)"></i>
            <h5 class="m-0 fw-bold text-dark">HOSPITAL GESTOR</h5>
        </div>
        <div>
            <span class="me-3 text-muted small">
                Hola,<strong>@nombreMostrar</strong>
            </span>
            <a href="@Url.Action("Logout", "Account")" class="btn btn-outline-danger btn-sm px-3">Salir</a>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <small class="text-uppercase text-white-50">Portal de Pacientes</small>
            </div>

            <a href="@Url.Action("Paciente", "Portal")" class="@(ViewContext.RouteData.Values["Action"].ToString() == "Paciente" ? "active" : "")">
                <i class="bi bi-house-door"></i> Inicio
            </a>

            <a href="@Url.Action("MisTurnos", "Portal")" class="@(ViewContext.RouteData.Values["Action"].ToString() == "MisTurnos" ? "active" : "")">
                <i class="bi bi-calendar-event"></i> Mis Turnos
            </a>

            <a href="@Url.Action("MisEstudios", "Portal")" class="@(ViewContext.RouteData.Values["Action"].ToString() == "MisEstudios" ? "active" : "")">
                <i class="bi bi-file-earmark-medical"></i> Mis Estudios
            </a>

            <a href="@Url.Action("MisRecetas", "Portal")" class="@(ViewContext.RouteData.Values["Action"].ToString() == "MisRecetas" ? "active" : "")">
                <i class="bi bi-capsule"></i> Recetas
            </a>

            <a href="@Url.Action("MisDatos", "Portal")" class="@(ViewContext.RouteData.Values["Action"].ToString() == "MisDatos" ? "active" : "")">
                <i class="bi bi-person-gear"></i> Mis Datos
            </a>
        </div>

        <div class="content">
            <main role="main">
                @RenderBody()
            </main>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>